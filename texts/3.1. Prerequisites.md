[//]: # (# 3.1. Prerequisites)
# 3.1. å…ˆå†³æ¡ä»¶
---

[//]: # (### âš¡ï¸ TL;DR â€” See [Reflex Wiki][reflex-wiki] first. Having some good anticheating experience will help.)
### âš¡ï¸ TL;DR â€” é¦–å…ˆæŸ¥çœ‹ [Reflex Wiki][reflex-wiki]ã€‚ æœ‰ä¸€äº›è‰¯å¥½çš„åä½œå¼Šç»éªŒå°†æœ‰æ‰€å¸®åŠ©ã€‚

---



[//]: # (### â„¹ï¸ General)
### â„¹ï¸ ä¸€èˆ¬ä¿¡æ¯

[//]: # (What we publish isn't expected to be easily understood by an unprepared reader. This is more of a set of "recommendations" and "inspirations" for experienced developers of anticheat software, or just for some of you who are way, way too curious *&#40;I'm looking at you, Wronger!&#41;*.)

[//]: # ()
[//]: # (Take everything written within the published materials with a grain of salt. Reflex has never been a flawless anticheat. It's just that we believe that it was a good one. Good enough to inspire some talented members of the cheating and anticheating community, and make hacking in Minecraft harder and less accessible. That being said, please pay attention to all you read and bear in mind that all checks and statements may have issues and serious mistakes. Some parts of the anticheat may even cause the "Why does this .... even work?!" feeling, and that's.. OK, I guess? This is not a "how to create an awesome anticheat" tutorial. This is just something that we believe might have some value for some people.)

[//]: # ()
[//]: # (If you're familiar with the Reflex Anticheat, and perhaps used it on your servers, played with its configuration, and ever talked to the dev team, then you should probably be good to go already. Otherwise, **we encourage you to familiarize with [the official Reflex Wiki][reflex-wiki]** first â€” it contains a lot of useful information that will not be repeated here, but may sometimes be referenced.)

æˆ‘ä»¬å‘å¸ƒçš„å†…å®¹ä¸ä¼šè¢«æœªç»å‡†å¤‡çš„è¯»è€…è½»æ˜“ç†è§£ã€‚ è¿™æ›´åƒæ˜¯ä¸€ç»„é’ˆå¯¹ç»éªŒä¸°å¯Œçš„åä½œå¼Šè½¯ä»¶å¼€å‘äººå‘˜çš„â€œå»ºè®®â€å’Œâ€œçµæ„Ÿâ€ï¼Œæˆ–è€…åªæ˜¯å¯¹ä¸€äº›è¿‡äºå¥½å¥‡çš„äººçš„ä¸€äº›å»ºè®® *ï¼ˆæˆ‘åœ¨çœ‹ä½ ï¼ŒWrongerï¼ï¼‰*ã€‚

è¯·ä»¥ä¸€é¢—è°¨æ…çš„å¿ƒå¯¹å¾…æ‰€å‘å¸ƒææ–™ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ Reflex ä»æ¥éƒ½ä¸æ˜¯ä¸€ä¸ªå®Œç¾çš„åä½œå¼Šæ’ä»¶ã€‚ åªæ˜¯æˆ‘ä»¬ç›¸ä¿¡å®ƒæ˜¯ä¸€ä¸ªå¥½çš„åä½œå¼Šæ’ä»¶ã€‚ è¶³ä»¥æ¿€å‘ä¸€äº›æœ‰æ‰åçš„ä½œå¼Šå’Œåä½œå¼Šç¤¾åŒºæˆå‘˜ï¼Œå¹¶ä½¿ Minecraft ä¸­çš„é»‘å®¢æ›´åŠ å›°éš¾ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œè¯·æ³¨æ„æ‚¨æ‰€é˜…è¯»çš„æ‰€æœ‰å†…å®¹ï¼Œå¹¶ç‰¢è®°æ‰€æœ‰æ£€æŸ¥å’Œé™ˆè¿°å¯èƒ½å­˜åœ¨é—®é¢˜å’Œä¸¥é‡é”™è¯¯ã€‚ åä½œå¼Šæ’ä»¶çš„æŸäº›éƒ¨åˆ†ç”šè‡³å¯èƒ½ä¼šå¼•èµ·â€œä¸ºä»€ä¹ˆè¿™ä¸ª....ç”šè‡³æœ‰æ•ˆï¼Ÿï¼â€ çš„æ„Ÿè§‰ï¼Œè¿™æ˜¯å¯è¡Œçš„ï¼Œæˆ‘çŒœï¼Ÿ è¿™ä¸æ˜¯ä¸€ä¸ªâ€œå¦‚ä½•åˆ›å»ºä¸€ä¸ªä»¤äººæ•¬ç•çš„åä½œå¼Šæ’ä»¶â€æ•™ç¨‹ã€‚ è¿™åªæ˜¯æˆ‘ä»¬è®¤ä¸ºå¯èƒ½å¯¹æŸäº›äººæœ‰ä»·å€¼çš„ä¸œè¥¿ã€‚

å¦‚æœæ‚¨ç†Ÿæ‚‰ Reflex åä½œå¼Šæ’ä»¶ï¼Œå¹¶ä¸”å¯èƒ½å·²ç»åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šä½¿ç”¨è¿‡å®ƒï¼Œç©è¿‡å®ƒçš„é…ç½®ï¼Œå¹¶ä¸”æ›¾ç»ä¸å¼€å‘å›¢é˜Ÿäº¤è°ˆè¿‡ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥å·²ç»å‡†å¤‡å¥½äº†ã€‚ å¦åˆ™ï¼Œ**æˆ‘ä»¬å»ºè®®æ‚¨é¦–å…ˆç†Ÿæ‚‰ [å®˜æ–¹ Reflex Wiki][reflex-wiki]** - å®ƒåŒ…å«äº†å¾ˆå¤šæœ‰ç”¨çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯ä¸ä¼šåœ¨è¿™é‡Œé‡å¤ï¼Œä½†æœ‰æ—¶å¯èƒ½ä¼šè¢«å¼•ç”¨ã€‚


[//]: # (### ğŸ“ Fix your angles)
### ğŸ“ ä¿®å¤ä½ çš„è§’åº¦

[//]: # (In quite many open source or unobfuscated anticheats I often see people make angle comparisons like `if &#40;abs&#40;oldYaw - newYaw&#41; > 1.0&#41; ...`. **This is wrong for 99.9% cases.** Angles in Minecraft &#40;and particularly, although not only, Bukkit&#41; aren't always within the [0;360] &#40;or [-180;180]&#41; range. For example, the difference between an angle of `5.0` degrees and an angle of `368.0` degrees is &#40;normally&#41; expected to be `-3.0`. Naive, "trigonometry-unaware" calculations will lead to invalid results here, and that will often result in checks randomly not working or misbehaving.)
åœ¨å¾ˆå¤šå¼€æº/æœªæ··æ·†çš„åä½œå¼Šæ’ä»¶ä¸­ï¼Œæˆ‘ç»å¸¸çœ‹åˆ°äººä»¬è¿›è¡Œè§’åº¦æ¯”è¾ƒï¼Œä¾‹å¦‚ `if (abs(oldYaw - newYaw) > 1.0) ...`ã€‚ **è¿™åœ¨ 99.9% çš„æƒ…å†µä¸‹éƒ½æ˜¯é”™è¯¯çš„ã€‚** Minecraft ä¸­çš„è§’åº¦ï¼ˆå°¤å…¶æ˜¯ Bukkitï¼Œè™½ç„¶ä¸ä»…é™äºæ­¤ï¼‰å¹¶ä¸æ€»æ˜¯åœ¨ [0;360]ï¼ˆæˆ– [-180;180]ï¼‰èŒƒå›´å†…ã€‚ ä¾‹å¦‚ï¼Œè§’åº¦ä¸º `5.0` åº¦å’Œè§’åº¦ä¸º `368.0` åº¦ä¹‹é—´çš„å·®å¼‚é€šå¸¸é¢„æœŸä¸º `-3.0`ã€‚ è¿™é‡Œçš„å¤©çœŸçš„â€œä¸æ‡‚ä¸‰è§’å­¦â€çš„è®¡ç®—å°†å¯¼è‡´æ— æ•ˆçš„ç»“æœï¼Œå¹¶ä¸”è¿™é€šå¸¸ä¼šå¯¼è‡´æ£€æŸ¥éšæœºä¸èµ·ä½œç”¨æˆ–è€…è¡Œä¸ºå¼‚å¸¸ã€‚

[//]: # (**See [this StackOverflow thread][so-angles], for example.**)
**ä¾‹å¦‚ï¼Œè¯·å‚è§ [æ­¤ StackOverflow å¸–å­][so-angles]ã€‚**

[//]: # (In all code snippets and references you'll see in this repository, bear in mind that "angle difference" means the **correct**, "trigonomery-aware", angle difference calculation. In Reflex code, that's usually accomplished with the use of the `angle&#40;x, y&#41;` method.)
åœ¨æœ¬å­˜å‚¨åº“ä¸­çœ‹åˆ°çš„æ‰€æœ‰ä»£ç ç‰‡æ®µå’Œå¼•ç”¨ä¸­ï¼Œè¯·è®°ä½ï¼Œâ€œè§’åº¦å·®â€è¡¨ç¤º **æ­£ç¡®çš„**ã€â€œä¸‰è§’å­¦æ„ŸçŸ¥â€çš„è§’åº¦å·®è®¡ç®—ã€‚ åœ¨ Reflex ä»£ç ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ `angle(x, y)` æ–¹æ³•æ¥å®ç°ã€‚

[//]: # (### ğŸ§© Common methods and concepts)

### ğŸ§© å¸¸ç”¨æ–¹æ³•å’Œæ¦‚å¿µ

[//]: # (Explaining some commonly repeating parts of Reflex code and assumptions here.)

[//]: # (**If you're looking at a code snippet somewhere, and something isn't explained there, then it's probably explained here. If not, and you can't figure out yourself, don't hesitate to ask us!**)

[//]: # ()
[//]: # (- `Stats` is a one-per-player object that stores basically all anticheat data for that player. Created on join, deleted on quit, and used throughout the entire playing process.)

[//]: # ()
[//]: # (- `matchIn&#40;x, a, b&#41;` â€” Check if `a <= x <= b`.)

[//]: # ()
[//]: # (- `matchEx&#40;x, a, b&#41;` â€” Check if `a < x < b`.)

[//]: # ()
[//]: # (- `NumberStorage`s are a "moving window" containing "recent" numerical &#40;`double`&#41; data. They have a limited size. An attempt to add an element to a full storage will remove the first &#40;"oldest"&#41; element, shift all elements to the left, and place the new &#40;"newest"&#41; element in the end.)

[//]: # ()
[//]: # (   - Consider this part of code: `stats.addInCreatedNumberStorage&#40;"balYaws", 80, yaw&#41;`. This adds number `yaw` in a `NumberStorage` with key `"balYaws"`. If the storage does not exist, it is created and initialized with capacity &#40;max size&#41; of `80`. The method then returns the created/existed `NumberStorage` instance.)

è§£é‡Š Reflex ä»£ç ä¸­ä¸€äº›å¸¸è§é‡å¤éƒ¨åˆ†å’Œå‡è®¾ï¼š

**å¦‚æœä½ åœ¨æŸå¤„çœ‹åˆ°ä»£ç ç‰‡æ®µï¼Œè€Œé‚£é‡Œæ²¡æœ‰è§£é‡ŠæŸäº›å†…å®¹ï¼Œé‚£ä¹ˆå¯èƒ½åœ¨è¿™é‡Œæœ‰è§£é‡Šã€‚å¦‚æœæ²¡æœ‰ï¼Œå¹¶ä¸”ä½ è‡ªå·±æ— æ³•å¼„æ¸…æ¥šï¼Œä¸è¦çŠ¹è±«å‘æˆ‘ä»¬è¯¢é—®ï¼

- `Stats` æ˜¯ä¸€ä¸ªæ¯ä¸ªç©å®¶ä¸€ä¸ªçš„å¯¹è±¡ï¼ŒåŸºæœ¬ä¸Šå­˜å‚¨äº†è¯¥ç©å®¶çš„æ‰€æœ‰åä½œå¼Šæ•°æ®ã€‚åœ¨ç©å®¶åŠ å…¥æ—¶åˆ›å»ºï¼Œåœ¨é€€å‡ºæ—¶åˆ é™¤ï¼Œåœ¨æ•´ä¸ªæ¸¸æˆè¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚

- matchIn(x, a, b) â€” æ£€æŸ¥ x æ˜¯å¦æ»¡è¶³ a <= x <= bã€‚

- matchEx(x, a, b) â€” æ£€æŸ¥ x æ˜¯å¦æ»¡è¶³ a < x < bã€‚

- NumberStorage æ˜¯ä¸€ä¸ªåŒ…å«â€œæœ€è¿‘â€æ•°å€¼ï¼ˆdoubleï¼‰æ•°æ®çš„â€œç§»åŠ¨çª—å£â€ã€‚å®ƒä»¬å…·æœ‰æœ‰é™çš„å¤§å°ã€‚å½“å°è¯•å‘å·²æ»¡çš„å­˜å‚¨ä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œä¼šåˆ é™¤ç¬¬ä¸€ä¸ªï¼ˆâ€œæœ€è€çš„â€ï¼‰å…ƒç´ ï¼Œå°†æ‰€æœ‰å…ƒç´ å‘å·¦ç§»åŠ¨ï¼Œå¹¶å°†æ–°çš„ï¼ˆâ€œæœ€æ–°çš„â€ï¼‰å…ƒç´ æ”¾ç½®åœ¨æœ«å°¾ã€‚

- è€ƒè™‘è¿™æ®µä»£ç ï¼šstats.addInCreatedNumberStorage("balYaws", 80, yaw)ã€‚è¿™å°†æ•°å€¼ yaw æ·»åŠ åˆ°é”®ä¸º "balYaws" çš„ NumberStorage ä¸­ã€‚å¦‚æœå­˜å‚¨ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºå¹¶åˆå§‹åŒ–å®¹é‡ï¼ˆæœ€å¤§å¤§å°ï¼‰ä¸º 80ã€‚ç„¶åè¯¥æ–¹æ³•è¿”å›å·²åˆ›å»º/å­˜åœ¨çš„ NumberStorage å®ä¾‹ã€‚



---

## âš–ï¸ è®¸å¯è¯

[Reflex Anticheat Internals][reflex-anticheat-internals] Â© 2023 by Reflex Development Team ([DarksideCode (German)][dev-german], [sinnlosername (Florian)][dev-florian], [StevenKGER (Steven)][dev-steven], and others) is licensed under [CC BY 4.0][license]. To view a copy of this license, visit http://creativecommons.org/licenses/by/4.0/

[license]: http://creativecommons.org/licenses/by/4.0

[reflex-anticheat-internals]: https://github.com/NagatoException/reflex-anticheat-internals-zh

[dev-german]: https://github.com/MeGysssTaa

[dev-florian]: https://github.com/sinnlosername

[dev-steven]: https://github.com/StevenKGER

---

## [ğŸ  Return to main page][reflex-anticheat-internals]

---



[so-angles]: https://stackoverflow.com/questions/1878907/how-can-i-find-the-smallest-difference-between-two-angles-around-a-point





[reflex-wiki]: https://github.com/MeGysssTaa/ReflexIssueTracker/wiki



